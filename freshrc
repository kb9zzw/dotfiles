# vim: set ft=sh:

# handles updating fresh
fresh freshshell/fresh bin/fresh --bin

# Set profile to 'default' if undefined
[ -z ${PROFILE+x} ] && PROFILE=default

# Backup existing files
for file in ~/.bashrc ~/.bash_profile ~/.zshrc
do
  if [ -e "$file" ] && [ ! -L "$file" ]
  then
    mv -f $file $file.bak
  fi
done

# .gitconfig
fresh-options --file=~/.gitconfig --marker --ignore-missing
  fresh gitconfig/base
  fresh gitconfig/$PROFILE
fresh-options

# .gitignore
fresh-options --file=~/.gitignore --marker --ignore-missing
  fresh gitignore/base
  fresh gitignore/$PROFILE
fresh-options

# .bash_profile
fresh-options --file=~/.bash_profile --marker --ignore-missing
  # Base config
  fresh bash_profile/base
  fresh bash_profile/fresh
  fresh bash_profile/ls
  fresh bash_profile/git
  fresh bash_profile/notes
  fresh bash_profile/docker
  fresh bash_profile/python
  fresh bash_profile/conda
  fresh bash_profile/kubernetes
  fresh bash_profile/openssl
  fresh bash_profile/terraform
  fresh bash_profile/ruby

  # OS-specific stuff
  if [[ "$(uname)" == "Darwin" ]]; then
    fresh bash_profile/darwin
  fi

  # Environment-specific stuff
  fresh bash_profile/$PROFILE
fresh-options

# .bashrc
fresh-options --file=~/.bashrc  --marker --ignore-missing
  fresh bashrc/base
  fresh bashrc/$PROFILE
fresh-options

# .zshrc
fresh-options --file=~/.zshrc --marker --ignore-missing
  fresh zshrc/base
  fresh zshrc/$PROFILE
fresh-options

# .inputrc
fresh inputrc/base --file=~/.inputrc

# .vimrc
fresh-options --file=~/.vimrc --marker=\" --ignore-missing
  fresh vimrc/vundle.$PROFILE
  fresh vimrc/base
fresh-options

# .vim/ftplugin/python.vim
fresh vim/ftplugin/python.vim --file=~/.vim/after/ftplugin/python.vim

# initialze vim
init_vim() {
  if command -v vim &> /dev/null && ! [ -d $HOME/.vim/bundle/Vundle.vim ]; then
    echo "initializing vim"
    vim || [ -d $HOME/.vim/bundle/Vundle.vim ]
  fi
}

# .config/nvim/init.vim
fresh config/nvim/init.vim --file=~/.config/nvim/init.vim

# .config/terminator/config
fresh config/terminator/config --file=~/.config/terminator/config

# .config/yamllint/config
fresh config/yamllint/config --file=~/.config/yamllint/config

# .pylintrc
fresh pylintrc/base --file=~/.pylintrc

# .condarc
fresh condarc/base --file=~/.condarc

# .vscode
fresh vscode/extensions.txt.$PROFILE --file=~/.vscode/extensions.txt --ignore-missing
fresh vscode/vscode_extensions.sh --bin=~/bin/vscode_extensions.sh

# initialize vscode
init_vscode() {
  if command -v code &> /dev/null && ! [ -d $HOME/.vscode/extensions ]; then
    echo "initializing vscode"
    $HOME/bin/vscode_extensions.sh
  fi
}
# MacOS-specific stuff
if [[ "$(uname)" == "Darwin" ]]; then
  fresh darwin/DefaultKeyBinding.dict --file ~/Library/KeyBindings/DefaultKeyBinding.dict
fi

# Post-processing
fresh_after_build() {
  init_vim
  init_vscode
}
